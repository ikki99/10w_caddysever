# 文件管理器增强功能说明

## 🎉 新增功能

### 1. 多选文件/文件夹 ⭐ 新功能

**使用方法：**
1. 进入"文件管理"标签
2. 点击"多选模式"按钮
3. 勾选要操作的文件/文件夹
4. 点击"压缩选中"或"删除选中"

**功能：**
- ✅ 可同时选择多个文件和文件夹
- ✅ 显示已选择的文件数量
- ✅ 支持批量压缩
- ✅ 支持批量删除
- ✅ 自动计数选中项目

### 2. 文件/文件夹压缩 ⭐ 新功能

**使用方法：**

**方式一：多选压缩**
1. 开启多选模式
2. 选中要压缩的文件/文件夹
3. 点击"压缩选中"
4. 输入压缩文件名
5. 自动生成 ZIP 文件

**方式二：单个文件操作**
- 在后续版本中添加单文件快捷压缩

**特点：**
- ✅ 支持压缩多个文件
- ✅ 支持压缩文件夹（递归）
- ✅ 自动保留目录结构
- ✅ 生成标准 ZIP 格式
- ✅ 压缩文件保存在当前目录

### 3. ZIP 文件解压 ⭐ 新功能

**使用方法：**
1. 找到 ZIP 文件（文件名旁显示 📦 图标）
2. 点击"解压"按钮
3. 确认解压操作
4. 自动解压到同名文件夹

**特点：**
- ✅ 自动识别 ZIP 文件
- ✅ 一键解压
- ✅ 保留原始文件结构
- ✅ 安全检查（防止路径遍历攻击）
- ✅ 解压到同名文件夹

### 4. 代码编辑器 ⭐ 新功能

**支持的文件类型：**
- **代码文件**：.js, .html, .css, .php, .py, .go, .java
- **配置文件**：.json, .xml, .yml, .yaml, .ini, .conf, .env
- **文本文件**：.txt, .md, .log, .sh, .bat, .sql
- **其他**：.gitignore 等点文件

**使用方法：**
1. 点击可编辑文件名（会显示 📜 📝 等图标）
2. 在弹出的编辑器中修改代码
3. 点击"保存"按钮或按 `Ctrl+S`

**编辑器功能：**
- ✅ 语法识别（显示文件类型）
- ✅ 等宽字体显示
- ✅ Tab 键插入空格（4个空格）
- ✅ Ctrl+S 快捷键保存
- ✅ 自动备份（保存时创建 .backup 文件）
- ✅ 大小限制（10MB 以内）

**快捷键：**
- `Ctrl + S` - 保存文件
- `Tab` - 插入 4 个空格
- `Esc` - 关闭编辑器（需确认）

### 5. 文件/文件夹重命名 ⭐ 新功能

**使用方法：**
1. 点击任意文件/文件夹的"重命名"按钮
2. 输入新名称
3. 确认重命名

**特点：**
- ✅ 支持文件和文件夹
- ✅ 检测名称冲突
- ✅ 自动验证
- ✅ 立即生效

### 6. 改进的新建文件夹

**改进内容：**
- ✅ 名称验证（防止非法字符）
- ✅ 重复检测（避免覆盖）
- ✅ 详细错误提示
- ✅ 成功反馈

**允许的字符：**
- 字母（a-z, A-Z）
- 数字（0-9）
- 中文
- 下划线（_）
- 连字符（-）
- 空格

### 7. 文件图标优化

**新增图标：**
- 📜 JavaScript (.js)
- 🌐 HTML (.html, .htm)
- 🎨 CSS (.css)
- 🐘 PHP (.php)
- 🐍 Python (.py)
- 🔷 Go (.go)
- ☕ Java (.java)
- 📝 Text (.txt)
- 📖 Markdown (.md)
- 📦 压缩文件 (.zip, .rar, .7z)
- 🖼️ 图片 (.jpg, .png, .gif, .svg)
- 📕 PDF (.pdf)
- 📘 Word (.doc, .docx)
- 📗 Excel (.xls, .xlsx)
- 📋 JSON (.json)
- 📄 其他文件

## 🎨 界面改进

### 文件列表工具栏

**新增按钮：**
- "多选模式" - 切换多选功能
- "压缩选中" - 压缩选中的文件（多选模式下显示）
- "删除选中" - 批量删除（多选模式下显示）
- 选择计数器 - 显示已选择的文件数

### 文件操作按钮

**每个文件/文件夹的按钮：**
- "解压" - ZIP 文件专用
- "编辑" - 可编辑文件专用
- "下载" - 文件下载
- "重命名" - 重命名文件/文件夹
- "删除" - 删除文件/文件夹

### 代码编辑器界面

- 标题栏显示文件名和语言类型
- 保存按钮（带快捷键提示）
- 关闭按钮
- 大文本区域（可调整大小）
- 等宽字体
- 提示信息

## 📊 技术细节

### 后端 API

**新增接口：**
```
POST /api/files/compress       - 压缩文件
POST /api/files/decompress     - 解压文件
GET  /api/files/read           - 读取文件内容
POST /api/files/save           - 保存文件内容
POST /api/files/rename         - 重命名文件/文件夹
```

**改进接口：**
```
POST /api/files/create-folder  - 改进的文件夹创建
```

### 前端文件

**新增文件：**
- `web/static/file-manager.js` - 增强的文件管理功能
- `internal/api/files.go` - 文件操作 API

**修改文件：**
- `web/static/app.js` - 改进 createNewFolder 函数
- `internal/api/system.go` - 改进 CreateFolderHandler
- `internal/api/template.go` - 添加编辑器模态框
- `main.go` - 注册新路由

## 🔒 安全特性

### 文件操作安全

- ✅ 路径遍历攻击防护
- ✅ 文件大小限制（编辑器 10MB）
- ✅ 文件名验证
- ✅ 自动备份（编辑时）
- ✅ www 根目录限制

### 解压安全

- ✅ 路径遍历检测
- ✅ 文件名验证
- ✅ 目标目录检查
- ✅ 安全的文件创建

## 📖 使用示例

### 示例 1：批量压缩项目文件

1. 进入项目目录
2. 开启多选模式
3. 选中所有项目文件
4. 点击"压缩选中"
5. 输入"project-backup"
6. 生成 `project-backup.zip`

### 示例 2：编辑配置文件

1. 找到 `config.json` 文件
2. 点击文件名或"编辑"按钮
3. 在编辑器中修改配置
4. 按 `Ctrl+S` 保存
5. 自动创建 `config.json.backup`

### 示例 3：解压上传的压缩包

1. 上传 ZIP 文件
2. 找到上传的文件（显示 📦 图标）
3. 点击"解压"按钮
4. 确认解压
5. 自动创建同名文件夹并解压

### 示例 4：整理文件

1. 创建新文件夹"images"
2. 开启多选模式
3. 选中所有图片文件
4. 拖动到 images 文件夹（或使用重命名移动）

## ⚠️ 注意事项

### 编辑器使用

- 大文件（>10MB）无法使用编辑器编辑
- 二进制文件不支持编辑
- 保存前会自动创建备份文件（.backup）
- 关闭前确保已保存

### 压缩功能

- ZIP 格式兼容性最好
- 压缩大文件可能需要时间
- 压缩文件保存在第一个选中文件的目录

### 解压功能

- 仅支持 ZIP 格式
- 解压到同名文件夹
- 如果目标文件夹已存在会覆盖

## 🚀 性能优化

- ✅ 异步文件操作
- ✅ 流式文件复制
- ✅ 批量操作优化
- ✅ 前端防抖处理

## 🔄 版本兼容性

**当前版本：** v1.0.1

**兼容性：**
- 完全向后兼容 v1.0.0
- 所有旧功能保持不变
- 新增功能独立模块化

## 📝 更新日志

### v1.0.1 新增功能

- ✅ 多选文件/文件夹
- ✅ 批量压缩（ZIP）
- ✅ 解压缩（ZIP）
- ✅ 代码编辑器
- ✅ 文件/文件夹重命名
- ✅ 改进的新建文件夹
- ✅ 文件图标优化

---

## 🎯 下一步计划

### v1.0.2 计划功能

- [ ] 文件拖拽移动
- [ ] 文件复制功能
- [ ] 批量重命名
- [ ] 搜索文件功能
- [ ] 文件预览（图片、PDF）
- [ ] 语法高亮（Monaco Editor）
- [ ] 代码格式化
- [ ] 支持更多压缩格式（RAR, 7Z）

---

**制作者：** 10w  
**邮箱：** wngx99@gmail.com  
**更新日期：** 2025-01-09
