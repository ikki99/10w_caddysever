# Caddy ç®¡ç†å™¨ - æ•…éšœæ’æŸ¥æŒ‡å—

## ğŸ” å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜ 1: Caddy å¯åŠ¨å¤±è´¥ - EOF é”™è¯¯

**é”™è¯¯ä¿¡æ¯**:
```
Error: adapting config using caddyfile: EOF
```

**åŸå› **: Caddyfile ä¸ºç©ºæˆ–æ ¼å¼ä¸æ­£ç¡®

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥æ˜¯å¦æœ‰é¡¹ç›®é…ç½®
2. è¿è¡Œè¯Šæ–­è„šæœ¬: `powershell -ExecutionPolicy Bypass -File diagnose.ps1`
3. å¦‚æœæ²¡æœ‰é¡¹ç›®ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆé»˜è®¤é…ç½®
4. é‡å¯ Caddy æœåŠ¡

**é¢„é˜²æªæ–½**:
- v0.0.11 å·²ä¿®å¤æ­¤é—®é¢˜
- æ²¡æœ‰é¡¹ç›®æ—¶ä¼šè‡ªåŠ¨ç”Ÿæˆé»˜è®¤é…ç½®

---

### é—®é¢˜ 2: åŸŸåæ ¼å¼é”™è¯¯

**é”™è¯¯ä¿¡æ¯**:
```
Error: adapting config using caddyfile: ambiguous site definition: c808.333.606.f89f.top
```

**åŸå› **: è¾“å…¥çš„åŸŸåæ ¼å¼ä¸æ­£ç¡®

**å¸¸è§é”™è¯¯åŸŸå**:
- `c808.333.606.f89f.top` âŒ (æ•°å­—ç‚¹åˆ†æ ¼å¼é”™è¯¯)
- `my site.com` âŒ (åŒ…å«ç©ºæ ¼)
- `-example.com` âŒ (ä»¥è¿å­—ç¬¦å¼€å¤´)
- `example..com` âŒ (è¿ç»­ç‚¹å·)

**æ­£ç¡®æ ¼å¼**:
- `example.com` âœ…
- `www.example.com` âœ…
- `api.subdomain.example.com` âœ…
- `localhost` âœ…

**è§£å†³æ–¹æ¡ˆ**:
1. ç¼–è¾‘é¡¹ç›®ï¼Œä¿®æ”¹åŸŸåä¸ºæ­£ç¡®æ ¼å¼
2. åˆ é™¤æ— æ•ˆåŸŸåçš„é¡¹ç›®
3. é‡æ–°åˆ›å»ºé¡¹ç›®æ—¶æ³¨æ„åŸŸåæ ¼å¼
4. v0.0.11 å·²æ·»åŠ å‰ç«¯éªŒè¯ï¼Œä¼šè‡ªåŠ¨æ£€æµ‹é”™è¯¯

---

### é—®é¢˜ 3: SSL è¯ä¹¦ç”³è¯·å¤±è´¥

**é”™è¯¯ä¿¡æ¯**:
```
{"level":"warn","msg":"stapling OCSP","error":"no OCSP stapling..."}
```

**åŸå› **: 
- åŸŸåæœªæ­£ç¡®è§£æ
- ç«¯å£æœªå¼€æ”¾
- è¯ä¹¦ç”³è¯·é¢‘ç‡é™åˆ¶

**è§£å†³æ–¹æ¡ˆ**:

1. **æ£€æŸ¥åŸŸåè§£æ**:
```bash
nslookup your-domain.com
ping your-domain.com
```

2. **æ£€æŸ¥ç«¯å£å¼€æ”¾**:
```bash
netstat -ano | findstr ":80"
netstat -ano | findstr ":443"
```

3. **æ£€æŸ¥é˜²ç«å¢™**:
```bash
# å…è®¸ 80 å’Œ 443 ç«¯å£
netsh advfirewall firewall add rule name="Caddy HTTP" dir=in action=allow protocol=TCP localport=80
netsh advfirewall firewall add rule name="Caddy HTTPS" dir=in action=allow protocol=TCP localport=443
```

4. **ç­‰å¾… DNS ç”Ÿæ•ˆ**: 
   - DNS è§£æå¯èƒ½éœ€è¦ 1-48 å°æ—¶
   - ä½¿ç”¨ `nslookup` ç¡®è®¤è§£ææ­£ç¡®

5. **æ£€æŸ¥è¯ä¹¦é™åˆ¶**:
   - Let's Encrypt é™åˆ¶: æ¯å‘¨æ¯åŸŸå 5 æ¬¡
   - å¦‚æœè¶…é™ï¼Œç­‰å¾…ä¸€å‘¨åé‡è¯•

---

### é—®é¢˜ 4: é¡¹ç›®æ— æ³•å¯åŠ¨

**ç—‡çŠ¶**: ç‚¹å‡»å¯åŠ¨æŒ‰é’®åé¡¹ç›®çŠ¶æ€ä»ä¸º"å·²åœæ­¢"

**æ’æŸ¥æ­¥éª¤**:

1. **æ£€æŸ¥å¯åŠ¨å‘½ä»¤**:
   - ç¡®ä¿å¯åŠ¨å‘½ä»¤æ­£ç¡®
   - ç¡®ä¿å¯æ‰§è¡Œæ–‡ä»¶å­˜åœ¨
   - ç¡®ä¿æœ‰æ‰§è¡Œæƒé™

2. **æŸ¥çœ‹é¡¹ç›®æ—¥å¿—**:
   - ä½ç½®: `data/logs/project_<id>.log`
   - æŸ¥çœ‹é”™è¯¯ä¿¡æ¯

3. **æ£€æŸ¥ç«¯å£å ç”¨**:
```bash
netstat -ano | findstr ":<ç«¯å£å·>"
```

4. **æ‰‹åŠ¨æµ‹è¯•å¯åŠ¨**:
   - æ‰“å¼€å‘½ä»¤è¡Œ
   - è¿›å…¥é¡¹ç›®ç›®å½•
   - æ‰‹åŠ¨æ‰§è¡Œå¯åŠ¨å‘½ä»¤

---

### é—®é¢˜ 5: æ‰˜ç›˜å›¾æ ‡ä¸æ˜¾ç¤º

**åŸå› **: 
- ç³»ç»Ÿæ‰˜ç›˜è®¾ç½®éšè—äº†å›¾æ ‡
- ä½¿ç”¨äº† `--no-tray` å‚æ•°

**è§£å†³æ–¹æ¡ˆ**:

1. **æ£€æŸ¥ç³»ç»Ÿæ‰˜ç›˜è®¾ç½®**:
   - Windows 10/11: è®¾ç½® â†’ ä¸ªæ€§åŒ– â†’ ä»»åŠ¡æ 
   - é€‰æ‹©åœ¨ä»»åŠ¡æ ä¸Šæ˜¾ç¤ºçš„å›¾æ ‡
   - å¯ç”¨ Caddy ç®¡ç†å™¨

2. **æ£€æŸ¥å¯åŠ¨å‚æ•°**:
   - ä¸è¦ä½¿ç”¨ `--no-tray` å‚æ•°
   - ä½¿ç”¨ `caddy-manager.exe` ç›´æ¥å¯åŠ¨

3. **é‡å¯ç¨‹åº**: é€€å‡ºåé‡æ–°å¯åŠ¨

---

### é—®é¢˜ 6: æ— æ³•è®¿é—®ç®¡ç†é¢æ¿

**ç—‡çŠ¶**: æµè§ˆå™¨æ‰“ä¸å¼€ http://localhost:8989

**æ’æŸ¥æ­¥éª¤**:

1. **æ£€æŸ¥ç¨‹åºæ˜¯å¦è¿è¡Œ**:
```bash
tasklist | findstr "caddy-manager"
```

2. **æ£€æŸ¥ç«¯å£å ç”¨**:
```bash
netstat -ano | findstr ":8989"
```

3. **æ£€æŸ¥é˜²ç«å¢™**:
   - å…è®¸ç¨‹åºé€šè¿‡é˜²ç«å¢™
   - æˆ–ä¸´æ—¶å…³é—­é˜²ç«å¢™æµ‹è¯•

4. **å°è¯•å…¶ä»–ç«¯å£**:
```bash
caddy-manager.exe --port 9090
```

5. **æ£€æŸ¥æµè§ˆå™¨**:
   - æ¸…é™¤ç¼“å­˜
   - å°è¯•æ— ç—•æ¨¡å¼
   - å°è¯•å…¶ä»–æµè§ˆå™¨

---

### é—®é¢˜ 7: æ•°æ®åº“é”å®šé”™è¯¯

**é”™è¯¯ä¿¡æ¯**: `database is locked`

**åŸå› **: å¤šä¸ªè¿›ç¨‹åŒæ—¶è®¿é—®æ•°æ®åº“

**è§£å†³æ–¹æ¡ˆ**:
1. å…³é—­æ‰€æœ‰ Caddy ç®¡ç†å™¨å®ä¾‹
2. åªå¯åŠ¨ä¸€ä¸ªå®ä¾‹
3. å¦‚æœé—®é¢˜æŒç»­ï¼Œé‡å¯è®¡ç®—æœº

---

### é—®é¢˜ 8: Caddyfile æ ¼å¼é”™è¯¯

**é”™è¯¯ä¿¡æ¯**: 
```
Caddyfile input is not formatted; run 'caddy fmt --overwrite'
```

**è§£å†³æ–¹æ¡ˆ**:
1. è¿™åªæ˜¯è­¦å‘Šï¼Œä¸å½±å“è¿è¡Œ
2. è‡ªåŠ¨æ ¼å¼åŒ–:
```bash
cd data\caddy
caddy fmt --overwrite Caddyfile
```

---

## ğŸ› ï¸ è¯Šæ–­å·¥å…·

### å¿«é€Ÿè¯Šæ–­
è¿è¡Œè¯Šæ–­è„šæœ¬è·å–ç³»ç»ŸçŠ¶æ€ï¼š
```bash
powershell -ExecutionPolicy Bypass -File diagnose.ps1
```

### æ‰‹åŠ¨æ£€æŸ¥

#### 1. æ£€æŸ¥ Caddyfile
```bash
type data\caddy\Caddyfile
```

#### 2. æ£€æŸ¥ Caddy æ—¥å¿—
```bash
type data\caddy\caddy.log | findstr /i "error"
```

#### 3. æ£€æŸ¥é¡¹ç›®æ—¥å¿—
```bash
dir data\logs\
type data\logs\project_1.log
```

#### 4. æ£€æŸ¥è¿›ç¨‹
```bash
tasklist | findstr "caddy"
```

#### 5. æ£€æŸ¥ç«¯å£
```bash
netstat -ano | findstr ":80"
netstat -ano | findstr ":443"
netstat -ano | findstr ":8989"
```

---

## ğŸ“ æ—¥å¿—åˆ†æ

### Caddy æ—¥å¿—ä½ç½®
`data/caddy/caddy.log`

### é¡¹ç›®æ—¥å¿—ä½ç½®
`data/logs/project_<id>.log`

### æŸ¥çœ‹æœ€æ–°æ—¥å¿—
```powershell
Get-Content data\caddy\caddy.log -Tail 50
```

### æŸ¥æ‰¾é”™è¯¯
```powershell
Get-Content data\caddy\caddy.log | Select-String -Pattern "error|Error|ERROR"
```

---

## ğŸ”§ é…ç½®æ–‡ä»¶ä½ç½®

| æ–‡ä»¶ | ä½ç½® | è¯´æ˜ |
|------|------|------|
| Caddyfile | `data/caddy/Caddyfile` | Caddy é…ç½®æ–‡ä»¶ |
| æ•°æ®åº“ | `data/caddy-manager.db` | SQLite æ•°æ®åº“ |
| Caddy æ—¥å¿— | `data/caddy/caddy.log` | Caddy è¿è¡Œæ—¥å¿— |
| é¡¹ç›®æ—¥å¿— | `data/logs/project_*.log` | å„é¡¹ç›®æ—¥å¿— |
| Caddy ç¨‹åº | `data/caddy/caddy.exe` | Caddy å¯æ‰§è¡Œæ–‡ä»¶ |

---

## ğŸ’¡ æœ€ä½³å®è·µ

### æ·»åŠ é¡¹ç›®
1. âœ… ä½¿ç”¨æ ‡å‡†åŸŸåæ ¼å¼
2. âœ… å…ˆæµ‹è¯•ç«¯å£è®¿é—®å†é…ç½®åŸŸå
3. âœ… ç¡®ä¿åŸŸåå·²è§£æå†å¯ç”¨ SSL
4. âœ… å¡«å†™æœ‰æ•ˆçš„è¯ä¹¦é‚®ç®±

### SSL é…ç½®
1. âœ… ç¡®ä¿åŸŸåå·²è§£æ
2. âœ… å¼€æ”¾ 80 å’Œ 443 ç«¯å£
3. âœ… ä¸è¦é¢‘ç¹ç”³è¯·è¯ä¹¦
4. âœ… ä½¿ç”¨æµ‹è¯•åŸŸåå…ˆéªŒè¯

### æ—¥å¸¸ç»´æŠ¤
1. âœ… å®šæœŸæŸ¥çœ‹æ—¥å¿—
2. âœ… åŠæ—¶æ›´æ–°åŸŸåè§£æ
3. âœ… å¤‡ä»½æ•°æ®åº“æ–‡ä»¶
4. âœ… å…³æ³¨è¯ä¹¦åˆ°æœŸæ—¶é—´

---

## ğŸ†˜ è·å–å¸®åŠ©

### æŸ¥çœ‹æ–‡æ¡£
- `README.md` - é¡¹ç›®ä»‹ç»
- `TRAY_GUIDE.md` - æ‰˜ç›˜åŠŸèƒ½æŒ‡å—
- `CADDYFILE_FIX.md` - é…ç½®ä¿®å¤è¯´æ˜
- `TROUBLESHOOTING.md` - æœ¬æ–‡æ¡£

### è¿è¡Œè¯Šæ–­
```bash
powershell -ExecutionPolicy Bypass -File diagnose.ps1
```

### æŸ¥çœ‹æ—¥å¿—
```bash
type data\caddy\caddy.log
```

### é‡ç½®é…ç½®
1. åœæ­¢ Caddy ç®¡ç†å™¨
2. åˆ é™¤ `data` ç›®å½•
3. é‡æ–°å¯åŠ¨ç¨‹åº
4. é‡æ–°é…ç½®

---

## ğŸ“ è”ç³»æ”¯æŒ

å¦‚æœä»¥ä¸Šæ–¹æ³•éƒ½æ— æ³•è§£å†³é—®é¢˜ï¼Œè¯·ï¼š
1. æ”¶é›†é”™è¯¯æ—¥å¿—
2. è®°å½•æ“ä½œæ­¥éª¤
3. æä¾›ç³»ç»Ÿä¿¡æ¯
4. è”ç³»æŠ€æœ¯æ”¯æŒ

---

**ç‰ˆæœ¬**: v0.0.11  
**æœ€åæ›´æ–°**: 2025å¹´
