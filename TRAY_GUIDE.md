# Caddy 管理器 - 托盘功能快速指南

## 🎯 系统托盘功能

### 托盘图标位置
启动 Caddy 管理器后，在 Windows 任务栏右下角（系统托盘）会显示一个蓝色的 "C" 字图标。

### 托盘菜单访问
- **鼠标左键**: 暂无操作
- **鼠标右键**: 显示功能菜单

---

## 📋 托盘菜单说明

### 1️⃣ 状态显示
```
● 状态: Caddy 运行中 ✓    ← Caddy 正在运行
○ 状态: Caddy 未运行 ✗    ← Caddy 已停止
```
- 每 5 秒自动更新
- 点击无效（仅显示）

### 2️⃣ 打开管理面板
```
🌐 打开管理面板
```
- 自动在默认浏览器中打开 Web 管理界面
- 地址: http://localhost:8989

### 3️⃣ Caddy 服务控制
```
▶ 启动 Caddy      ← 启动 Caddy 服务器
⏸ 停止 Caddy      ← 停止 Caddy 服务器
🔄 重启 Caddy      ← 重启 Caddy 服务器
```
- 操作后状态会自动更新（1秒延迟）
- 重启 Caddy 会应用新的配置

### 4️⃣ 控制台窗口控制
```
📋 显示控制台     ← 显示程序控制台窗口
🔽 隐藏控制台     ← 隐藏控制台（后台运行）
```
- 隐藏控制台后程序继续运行
- 可随时通过托盘菜单恢复显示

### 5️⃣ 关于和退出
```
ℹ 关于           ← 显示版本信息
❌ 退出程序       ← 安全退出应用
```
- 退出前会显示确认对话框
- 确认后自动停止所有服务

---

## 🚀 常用操作

### 后台运行
1. 启动 Caddy 管理器
2. 右键托盘图标
3. 选择 "🔽 隐藏控制台"
4. 程序在后台运行，只显示托盘图标

### 快速打开管理面板
1. 右键托盘图标
2. 选择 "🌐 打开管理面板"
3. 浏览器自动打开

### 重启 Caddy 服务
1. 修改了项目配置后
2. 右键托盘图标
3. 选择 "🔄 重启 Caddy"
4. 等待 1-2 秒配置生效

### 安全退出
1. 右键托盘图标
2. 选择 "❌ 退出程序"
3. 在确认对话框点击 "是"
4. 等待程序自动停止所有服务

---

## 💡 使用技巧

### 技巧 1: 开机后台运行
```
1. 将 caddy-manager.exe 创建快捷方式
2. 放入 Windows 启动文件夹:
   C:\Users\你的用户名\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup
3. 重启电脑后程序自动启动
4. 使用托盘菜单隐藏控制台
```

### 技巧 2: 快速查看状态
```
鼠标悬停在托盘图标上 → 查看提示信息
显示内容:
- Caddy 管理器运行端口
- Caddy 服务运行状态
```

### 技巧 3: 托盘提示信息
```
运行中: "Caddy 管理器 - Caddy 运行中"
停止: "Caddy 管理器 - Caddy 未运行"
```

---

## ⚙️ Web 界面关闭应用

除了托盘菜单，还可以通过 Web 界面关闭应用：

1. 打开管理面板: http://localhost:8989
2. 进入"系统设置"标签
3. 滚动到底部"应用程序控制"
4. 点击"🔴 关闭应用程序"按钮
5. 确认关闭

---

## 🔄 关闭流程说明

无论使用哪种方式退出，都会执行相同的优雅关闭流程：

```
1. 显示确认对话框（如果是托盘退出）
   ↓
2. 停止 Caddy 服务器
   ↓
3. 停止所有运行中的项目
   ↓
4. 关闭 HTTP 服务器（等待现有请求完成，最多10秒）
   ↓
5. 关闭数据库连接
   ↓
6. 退出程序
```

**总耗时**: 通常 2-5 秒（取决于项目数量）

---

## ❓ 常见问题

### Q1: 托盘图标不显示？
**A**: 
- 检查系统托盘设置
- Windows 10/11: 设置 → 个性化 → 任务栏 → 选择在任务栏上显示的图标
- 确保没有使用 `--no-tray` 参数启动

### Q2: 隐藏控制台后怎么恢复？
**A**:
- 右键托盘图标
- 选择 "📋 显示控制台"

### Q3: 托盘菜单是灰色无法点击？
**A**:
- "状态"菜单项是只读的，无法点击
- 其他菜单项应该可以正常点击
- 如果全部灰色，可能是程序未正常启动

### Q4: 退出后托盘图标还在？
**A**:
- 这是 Windows 的缓存问题
- 鼠标悬停在图标上会自动消失
- 或者刷新任务栏（重启 explorer.exe）

### Q5: 可以同时运行多个实例吗？
**A**:
- 不建议，会导致端口冲突
- 如需运行多个，使用不同端口: `caddy-manager.exe --port 9090`

---

## 🎨 图标说明

托盘图标: **蓝色 "C" 字母**
- 代表 Caddy
- 16x16 像素
- 使用简洁设计风格

---

## 📞 反馈和支持

如果遇到问题或有建议：
1. 检查控制台输出（显示控制台查看错误信息）
2. 查看日志文件: `data/caddy/caddy.log`
3. 提交 Issue 或联系开发团队

---

**版本**: v0.0.10  
**最后更新**: 2025年
